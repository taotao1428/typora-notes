# DDD概念了解



## 概念



### 领域，子域和上下文

![img](/其他知识点/DDD/.assert/概念了解/v2-d84d6689ff952a9ae2fe5881b1cdee13_1440w.webp)



| 概念                  | 说明                                                         |
| --------------------- | ------------------------------------------------------------ |
| 领域（Domain）        | 一个组织所做的事情和其包含的一切。例如：云计算领域，电商领域 |
| 子域（SubDomain）     | 从问题空间角度划分领域，就形成不同的子域。例如：对于电商领域，订单子域、物流子域和支付子域就是它的子域 |
| 界限上下文（Context） | 界限上下文代表者领域内的解决方案。一个领域可以有多个界限上下文，也可以仅有一个界限上下文，这取决于具体的软件实现。例如：对于电商领域，我们使用只使用电商系统作为所有问题的解决方案，此时电商领域仅有一个电商上下文；也可以由订单系统、物流系统和支付系统等分别作为特定问题的解决方案，此时电商领域就有订单上下文，物流上下文，支付上下文等。 |



下图是一个系统的例子

1. 整个领域包含了电子商务系统、库存系统和外部预测系统三个界限上下文
2. 整个领域包含了产品目录子域、订单子域、发票子域、物流子域和库存子域
3. 电子商务系统包含了产品目录子域，订单子域，发票子域，部分物流子域
4. 库存系统包含了部分物流子域，部分库存子域
5. 外部预测系统包含了部分库存子域

![image-20220814163824073](/其他知识点/DDD/.assert/概念了解/image-20220814163824073.png)





### 实体，值对象，聚合，领域服务，领域事件











1. 领域划分
2. 上下文，领域模型存在与上下文中
3. 领域服务，领域服务对外通过整个领域的功能，里面会包含所有该领域的业务逻辑





同一个事物，在不同的上下文中，其对应的实体是不一样的。判断上下文是否划分合理，可以根据上下文件中的模型是否具有唯一含义判断。

![image-20220814163824073](/其他知识点/DDD/.assert/概念了解/image-20220814163824073.png)

聚合的规则

1. 一致性。如果多个实体有一致性关系，需要将它们聚合在一起
2. 最小化。可以方便维护，并且可以减少冲突，减少加载对象时的负担。



https://tech.meituan.com/2017/12/22/ddd-in-practice.html



![image-20220814225622634](/其他知识点/DDD/.assert/概念了解/image-20220814225622634.png)

核心子域：是业务成功的关键。

支撑子域：专注某一方面的业务

通用子域：整个业务系统都可能用到。





论坛上下文应该关心是谁发了帖子，而不关心谁有权限发帖子。谁有权限发帖是权限上下文负责的。





上下文边界之外，不会使用上下文内部的对象

如果业务系统中存在不同的上下文，那么上下文是如何映射的？不同上下文中的同一个对象，共享一个ID对象（唯一标识符）





界限上下文中，可以不仅包含模型。

![image-20220821160326250](/其他知识点/DDD/.assert/概念了解/image-20220821160326250.png)



上下文中包含的东西

1. 领域模型
2. 应用层
3. 基础服务层







1. 领域划分，界限上下文。核心域，支撑子域，通用子域
2. 领域模型。实体，值对象，聚合根，领域服务



![img](/其他知识点/DDD/.assert/概念了解/v2-d84d6689ff952a9ae2fe5881b1cdee13_1440w.webp)







## 架构

良好的架构：以业务为核心，隔离解耦外部依赖。将业务复杂度和技术复杂度隔离开。

![archWhy](/其他知识点/DDD/.assert/概念了解/68747470733a2f2f696d672d626c6f672e6373646e696d672e636e2f65323763323264373036303834656164393030633838333833323631333566332e706e67.png)

### 六边形模型

![img](/其他知识点/DDD/.assert/概念了解/webp-20221013235813247)

六边形模型中，应用程序和领域模型可以保持稳定，统一使用适配器与外部交互。

### 洋葱模型（整洁架构）

![img](/其他知识点/DDD/.assert/概念了解/v2-31466a5ecc8c8e979ffd1492cd18c031_1440w.webp)



洋葱模型与六边形模型的思想是一致。但洋葱模型更加细化

1. 六边形中的适配器在洋葱模型中细分为UserInterface和Infrastructure。
2. 六边形中的领域模型在洋葱模型中细分为领域服务和领域模型



### DDD模型

![img](/其他知识点/DDD/.assert/概念了解/webp)

1. 用户接口层：负责向用户显示信息和解释用户指令。这里的用户可能是：用户、程序、自动化测试和批处理脚本等等。
    领域层包含聚合根、实体、值对象、领域服务等领域模型中的领域对象。

2. 应用层：很薄的一层，理论上不应该有业务规则或逻辑，主要面向用例和流程相关的操作。但应用层又位于领域层之上，因为领域层包含多个聚合，所以它可以协调多个聚合的服务和领域对象完成服务编排和组合，协作完成业务操作。此外，应用层也是微服务之间交互的通道，它可以调用其它微服务的应用服务，完成微服务之间的服务组合和编排。

3. 领域层：是实现企业核心业务逻辑，通过各种校验手段保证业务的正确性。领域层主要体现领域模型的业务能力，它用来表达业务概念、业务状态和业务规则。领域层包含聚合根、实体、值对象、领域服务等领域模型中的领域对象

4. 基础层：是贯穿所有层的，它的作用就是为其它各层提供通用的技术和基础服务，包括第三方工具、驱动、消息中间件、网关、文件、缓存以及数据库等。比较常见的功能还是提供数据库持久化。





https://www.jianshu.com/p/36c76dbaa20c



三个模型对比

![img](/其他知识点/DDD/.assert/概念了解/webp-20221014000135807)



## 模型设计方法



### 四色建模法

四色建模法源于Peter Coad的《Java Modeling In Color With UML》，它是一种模型的分析和设计方法，他提出要把所有模型分为四种类型，用四种颜色表示

![img](/其他知识点/DDD/.assert/概念了解/webp-20221015104118432)



在四色模型中，我们将抽象出来的对象分为四种原型（archetype）

1. 业务关键时刻（moment interval）

这类对象往往是表现业务价值的关键对象，使用粉红色标记。 这类对象会在某一刻存在或者某一段时间内存在。例如一个外部的请求，一次下单或一次租赁



2. 角色（Role）

这类对象表示参与者的角色，一般用黄色标记。往往由人或者物来承担，会有相应的责任和权利，一般一个moment-interval对象会关联多个Role。例如一次下单涉及两个Role：客户-商品



3. 人-事-物（Party，place，thing）

这类对象表示参与者，一般用绿色标记。这列对象往往是客观存在的人物事，例如：人、组织、产品或者配件等，这些事物往往会在一种moment-interval 中扮演某个Role。例如，某个人会在一次购买中扮演Customer的角色，也可以在询价中扮演询价人的角色。

4. 描述（Description）

这类对象表示一般用于描述细节，一般使用蓝色标记



### 四色建模例子

#### 签约

https://developers.weixin.qq.com/community/develop/article/doc/0000a239230d901cbb4d15c0c51c13

当我们拿到一个实现信贷核心系统的需求时，首先我们要建立对应的领域知识。那我们如何去获取呢？比较有效的方式就是找领域专家，专家可以是这个领域的专家或者产品、运营都可以。目的是在与之沟通中理清业务流程，抽象必要的领域元素。

我们以借款流程为例，假设通过以上方法我们梳理出了信贷核心的借款流程。用户提出借款申请，风控运营人员审批通过后，系统扣减对应的用户额度，之后用户签署借款合同，系统生成对应的还款计划并放款到用户的账户。其流程大致如下：

![img](/其他知识点/DDD/.assert/概念了解/0.jpeg)



首选我们从业务流程中尝试寻找时标对象（用红色表示），可以认为是核心业务单据。此类对象是发生的事实，当出现问题的时候可以追溯。我们从上述业务流程可以分析得出，**借款申请对应借款单，借款审批对应审批单据，额度扣减对应额度扣减记录，签署合同对应签约记录，生成还款计划对应账单，放款对应支付单**。在找到时标对象后尝试寻找参与方（用绿色表示），一般可以是人、物、地点等。这里参与方包含风控运营、额度账户、资金账户、合同等。之后再分析参与方是以什么角色参与到业务流程中的（用黄色表示），风控运营是以审批人角色参与到业务中的。最后尝试给参与方添加一些描述信息（用蓝色表示），使其更具象。根据上述方法画图如下：

<img src="/其他知识点/DDD/.assert/概念了解/0-20221015155421493.jpeg" alt="img" style="zoom:50%;" />



#### 电商



用户下单购买图书，支付订单。电商管理员可以给图书设置促销记录，根据订单发货。



![img](/其他知识点/DDD/.assert/概念了解/webp-20221015160613164)



![img](/其他知识点/DDD/.assert/概念了解/webp-20221015160828388)







### 动名词建模法



